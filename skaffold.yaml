apiVersion: skaffold/v1beta8
kind: Config
profiles:

### Production config
- name: prod
  build:
    tagPolicy:
      sha256: {}
    artifacts:
    - image: asia.gcr.io/soe-trial-oota/app
      context: ./docker/docker-django
    - image: asia.gcr.io/soe-trial-oota/nginx
      context: ./docker/docker-nginx
    local:
      push: true
      useBuildkit: true
  deploy:
    kustomize:
      path: "./k8s/overlays/production"

### Local config
- name: local
  build:
    tagPolicy:
      sha256: {}
    artifacts:
    - image: app
      context: ./docker/docker-django
    - image: nginx
      context: ./docker/docker-nginx
    local:
      push: false
      useBuildkit: true
  deploy:
    kustomize:
      path: "./k8s/base/"
      flags:
        delete: ["--grace-period=0","--force"]
